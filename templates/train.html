{% extends "base.html" %}
{% block title %}ASCENDS — ML Performance Training &amp; Test{% endblock %}

{% block content %}

{% set ws_from_ctx = ws_id if ws_id is defined else None %}
{% set ws_from_qs = request.query_params.get('ws_id') if request else None %}
{% set ws_from_ck = request.cookies.get('ws_id') if request and request.cookies else None %}

<div style="font-size:12px; opacity:0.75; margin-bottom:6px;">
  <strong>Debug:</strong>
  ws(ctx)={{ ws_from_ctx }},
  ws(qs)={{ ws_from_qs }},
  ws(cookie)={{ ws_from_ck }},
  cols={{ (all_columns|length) if all_columns is defined and all_columns else 0 }},
  inputs={{ (inputs|length) if inputs is defined and inputs else 0 }},
  target={{ target if target is defined else None }}
</div>

<div class="train-page">
  <section class="panel">
    <h2>ML Performance Training &amp; Test</h2>

    <!-- Top row: 15% | 15% | 70% -->
    <div class="train-top">
      <!-- All Columns (15%) -->
      <div class="pane">
        <div class="card">
          <div class="card-title">All Columns</div>
          <div class="card-body train-pane-scroll">
            <em>Columns will appear here after selecting a dataset.</em>
          </div>
        </div>
      </div>

      <!-- Input / Target (15%) -->
      <div class="pane">
        <div class="card">
          <div class="card-title">Input / Target</div>
          <div class="card-body train-pane-scroll">
            <div><strong>Target:</strong> (not set)</div>
            <div class="mt-6"><strong>Inputs (0):</strong></div>
            <em>No inputs selected.</em>
          </div>
        </div>
      </div>

      <!-- Accuracy Test (70%) -->
      <div class="pane">
        <div class="card">
          <div class="card-title">Accuracy Test</div>
          <div class="card-body train-accuracy-body">
            <!-- Options toolbar (disabled placeholders) -->
            <div class="acc-toolbar">
              <strong>Task:</strong>
              <label><input type="radio" name="task" value="r" disabled checked> Regression</label>
              <label><input type="radio" name="task" value="c" disabled> Classification</label>

              <strong>Model:</strong>
              <select class="select" name="model" disabled>
                <option>RandomForest</option>
                <option>XGBoost</option>
                <option>HistGradientBoost</option>
                <option>SVR</option>
                <option>KNN</option>
                <option>Linear</option>
                <option>Ridge</option>
                <option>Lasso</option>
                <option>ElasticNet</option>
              </select>

              <strong>Test size:</strong>
              <input class="input" type="number" name="test_size" min="0.05" max="0.5" step="0.05" value="0.20" disabled>

              <strong>Tuning:</strong>
              <select class="select" name="tune" disabled>
                <option>off</option>
                <option>quick</option>
                <option>intense</option>
                <option>optuna</option>
                <option>bayes</option>
              </select>

              <button class="btn btn-sm" disabled>Train</button>
              <button class="btn btn-sm" disabled>Tune only</button>
              <a class="btn btn-sm disabled" aria-disabled="true">Use in Predict ➜</a>
            </div>

            <!-- Plot placeholder -->
            <div class="plot-box">
              <em>Parity plot with embedded metrics will render here after training.</em>
            </div>

            <!-- Thin save strip -->
            <div class="save-strip">
              <label for="save-name"><strong>Name:</strong></label>
              <input id="save-name" class="input" type="text" placeholder="e.g., my_best_model" disabled>
              <button class="btn btn-sm" disabled>Save Model</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom row: 60% | 40% -->
    <div class="train-bottom">
      <!-- Test History (60%) -->
      <div class="pane">
        <div class="card">
          <div class="card-title">Test History</div>
          <div class="card-body">
            <em>Recent results for the current model setup will appear here.</em>
          </div>
        </div>
      </div>

      <!-- ML Models (40%) -->
      <div class="pane">
        <div class="card">
          <div class="card-title">ML Models</div>
          <div class="card-body">
            <em>Saved models will appear here with metrics, inputs, target, and actions.</em>
          </div>
        </div>
      </div>
    </div>

  </section>
</div>
{% endblock %}
