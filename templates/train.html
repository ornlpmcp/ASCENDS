{% extends "base.html" %}
{% block title %}ASCENDS — ML Performance Training &amp; Test{% endblock %}

{% block content %}
<div class="train-page">
  <section class="panel">
    <h2>ML Performance Training &amp; Test</h2>

    <!-- Top row: 15% | 15% | 70% -->
    <div class="train-top">

      <!-- All Columns -->
      <div class="pane">
        <div class="card">
          <div class="card-title">All Columns</div>
          <div class="card-body train-pane-scroll">
            <form action="/train/select" method="post">
              {% if ws_id %}<input type="hidden" name="ws_id" value="{{ ws_id }}">{% endif %}

              <div class="toolbar inline">
                <button class="btn btn-sm" type="submit" name="action" value="select_all" {% if not ws_id %}disabled{% endif %}>Select all</button>
                <button class="btn btn-sm" type="submit" name="action" value="select_none" {% if not ws_id %}disabled{% endif %}>Select none</button>
              </div>

              <div class="subcard">
                <strong>Columns ({{ all_columns|length if all_columns else 0 }})</strong>
                <div class="mt-8">
                  <ul class="list">
                    {% for c in all_columns or [] %}
                      <li>
                        <label>
                          <input type="checkbox" name="columns" value="{{ c }}"
                                 {% if selected and c in selected %}checked{% endif %}
                                 {% if not ws_id %}disabled{% endif %}>
                          {{ c }}
                        </label>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>

              <div class="mt-8">
                <label for="target-choice"><strong>Target choice:</strong></label>
                <select id="target-choice" name="target_choice" class="select" {% if not ws_id %}disabled{% endif %}>
                  {% for c in all_columns or [] %}
                    <option value="{{ c }}" {% if target is defined and target == c %}selected{% endif %}>{{ c }}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-sm" type="submit" name="action" value="set_target" {% if not ws_id %}disabled{% endif %}>Set target</button>
              </div>

              <div class="toolbar inline mt-8">
                <button class="btn btn-sm" type="submit" name="action" value="to_inputs" {% if not ws_id %}disabled{% endif %}>→ Use selected as inputs</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Input / Target -->
      <div class="pane">
        <div class="card">
          <div class="card-title">Input / Target</div>
          <div class="card-body train-pane-scroll">
            <div><strong>Target:</strong> {{ target if target else "(not set)" }}</div>

            <form action="/train/select" method="post" class="mt-8">
              {% if ws_id %}<input type="hidden" name="ws_id" value="{{ ws_id }}">{% endif %}
              <div><strong>Inputs ({{ inputs|length if inputs else 0 }}):</strong></div>
              {% if inputs %}
                <ul class="list">
                  {% for c in inputs %}
                    <li><label><input type="checkbox" name="rm_inputs" value="{{ c }}"> {{ c }}</label></li>
                  {% endfor %}
                </ul>
                <button class="btn btn-sm" type="submit" name="action" value="remove_inputs" {% if not ws_id %}disabled{% endif %}>Remove selected</button>
              {% else %}
                <em>No inputs selected.</em>
              {% endif %}
            </form>
          </div>
        </div>
      </div>

      <!-- Accuracy Test (placeholder for now) -->
      <div class="pane">
        <div class="card">
          <div class="card-title">Accuracy Test</div>
          <div class="card-body train-accuracy-body">
            <div class="acc-toolbar">
              <strong>Task:</strong>
              <label><input type="radio" name="task" value="r" disabled checked> Regression</label>
              <label><input type="radio" name="task" value="c" disabled> Classification</label>

              <strong>Model:</strong>
              <select class="select" name="model" disabled>
                <option>RandomForest</option><option>XGBoost</option><option>HistGradientBoost</option>
                <option>SVR</option><option>KNN</option><option>Linear</option>
                <option>Ridge</option><option>Lasso</option><option>ElasticNet</option>
              </select>

              <strong>Test size:</strong>
              <input class="input" type="number" name="test_size" min="0.05" max="0.5" step="0.05" value="0.20" disabled>

              <strong>Tuning:</strong>
              <select class="select" name="tune" disabled>
                <option>off</option><option>quick</option><option>intense</option><option>optuna</option><option>bayes</option>
              </select>

              <button class="btn btn-sm" disabled>Train</button>
              <button class="btn btn-sm" disabled>Tune only</button>
              <a class="btn btn-sm disabled" aria-disabled="true">Use in Predict ➜</a>
            </div>

            <div class="plot-box">
              <em>Parity plot with embedded metrics will render here after training.</em>
            </div>

            <div class="save-strip">
              <label for="save-name"><strong>Name:</strong></label>
              <input id="save-name" class="input" type="text" placeholder="e.g., my_best_model" disabled>
              <button class="btn btn-sm" disabled>Save Model</button>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- /train-top -->

    <!-- Bottom row (placeholders) -->
    <div class="train-bottom">
      <div class="pane">
        <div class="card">
          <div class="card-title">Test History</div>
          <div class="card-body">
            <em>Recent results for the current model setup will appear here.</em>
          </div>
        </div>
      </div>
      <div class="pane">
        <div class="card">
          <div class="card-title">ML Models</div>
          <div class="card-body">
            <em>Saved models will appear here with metrics, inputs, target, and actions.</em>
          </div>
        </div>
      </div>
    </div>

  </section>
</div>
{% endblock %}
